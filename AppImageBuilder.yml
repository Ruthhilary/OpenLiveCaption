# AppImageBuilder configuration for OpenLiveCaption
# Creates Linux AppImage package

version: 1

AppDir:
  path: ./AppDir
  
  app_info:
    id: com.openlivecaption.app
    name: OpenLiveCaption
    icon: openlivecaption
    version: 2.0.0
    exec: usr/bin/openlivecaption
    exec_args: $@
  
  apt:
    arch: amd64
    sources:
      - sourceline: 'deb [arch=amd64] http://archive.ubuntu.com/ubuntu/ focal main restricted universe multiverse'
        key_url: 'http://keyserver.ubuntu.com/pks/lookup?op=get&search=0x3b4fe6acc0b21f32'
    
    include:
      # System libraries
      - libc6
      - libstdc++6
      - libgcc-s1
      - libgomp1
      
      # Audio libraries
      - libportaudio2
      - libasound2
      - libpulse0
      - libsndfile1
      
      # Qt dependencies
      - libqt6core6
      - libqt6gui6
      - libqt6widgets6
      - libqt6dbus6
      - libxcb1
      - libxcb-xinerama0
      - libxcb-icccm4
      - libxcb-image0
      - libxcb-keysyms1
      - libxcb-randr0
      - libxcb-render-util0
      - libxcb-shape0
      
      # Graphics libraries
      - libgl1
      - libglib2.0-0
      - libdbus-1-3
      
    exclude:
      # Exclude unnecessary packages
      - libgtk-3-0
      - libgtk-4-1
      - libwebkit2gtk-4.0-37
  
  files:
    include:
      - usr/bin/openlivecaption
      - usr/share/applications/openlivecaption.desktop
      - usr/share/icons/hicolor/256x256/apps/openlivecaption.png
    
    exclude:
      - usr/share/man
      - usr/share/doc
      - usr/share/lintian
      - usr/share/bug
  
  runtime:
    env:
      # Set library paths
      LD_LIBRARY_PATH: '${APPDIR}/usr/lib:${APPDIR}/usr/lib/x86_64-linux-gnu:${LD_LIBRARY_PATH}'
      PYTHONHOME: '${APPDIR}/usr'
      PYTHONPATH: '${APPDIR}/usr/lib/python3.8/site-packages'
      
      # Qt platform plugin
      QT_PLUGIN_PATH: '${APPDIR}/usr/lib/x86_64-linux-gnu/qt6/plugins'
      QT_QPA_PLATFORM_PLUGIN_PATH: '${APPDIR}/usr/lib/x86_64-linux-gnu/qt6/plugins/platforms'
      
      # Audio
      PULSE_LATENCY_MSEC: '60'
  
  test:
    fedora:
      image: appimagecrafters/tests-env:fedora-30
      command: ./AppRun --version
    
    debian:
      image: appimagecrafters/tests-env:debian-stable
      command: ./AppRun --version
    
    ubuntu:
      image: appimagecrafters/tests-env:ubuntu-xenial
      command: ./AppRun --version

AppImage:
  arch: x86_64
  update-information: guess
  sign-key: None
  
  # Compression
  comp: xz
